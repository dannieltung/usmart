<section class="introducao container">
  <%= render 'form' %>
  <div>
    <table class="table table-hover">
      <thead>
        <tr>
          <th scope="col">Nome</th>
          <th scope="col">Quantidade</th>
          <th scope="col">MÃ©dio</th>
        </tr>
      </thead>
      <tbody>
        <% @unique_ativos.each do |ativo| %>
          <tr>
            <td><%= link_to ativo.nome, ativo_path(ativo) %></td>
            <td><%= Ativo.where(nome: ativo.nome).where.not(quantidade: nil).map { |ativo| ativo.quantidade }.sum %></td>
            <% incomes = Ativo.where(nome: ativo.nome, quantidade: nil) %>
            <% stocks = Ativo.where(nome: ativo.nome).where.not(quantidade: nil) %>
            <td><%= number_to_currency(stocks.map { |ativo| ativo.total }.then { |a| (a.sum&.to_f - incomes.map { |ativo| ativo.preco}.sum) / stocks.map { |ativo| ativo.quantidade}.sum }, unit: 'R$ ', separator: ',', delimiter: '.') %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</section>